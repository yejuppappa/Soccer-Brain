# âš½ Soccer Brain - ìˆœìœ„/ê²°ê³¼/ë¼ì¸ì—… ìˆ˜ì§‘ (1ì‹œê°„ ê°„ê²©)
# ë°°ë‹¹ì€ ë³„ë„ ì›Œí¬í”Œë¡œìš°(collect-odds.yml)ì—ì„œ 10ë¶„ë§ˆë‹¤ ìˆ˜ì§‘

name: ğŸ“Š Hourly Data Collection

on:
  schedule:
    - cron: "0 * * * *"
  
  workflow_dispatch:
    inputs:
      tasks:
        description: "ì‹¤í–‰í•  íƒœìŠ¤í¬ (ì‰¼í‘œ êµ¬ë¶„)"
        required: false
        default: "standings,results,lineups"

concurrency:
  group: hourly-collection
  cancel-in-progress: false

jobs:
  collect:
    runs-on: ubuntu-latest
    timeout-minutes: 25

    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm install --ignore-scripts
        env:
          PUPPETEER_SKIP_DOWNLOAD: "true"

      - name: ğŸ”§ Prisma ìƒì„±
        run: npx prisma generate

      - name: ğŸ“Š ë°ì´í„° ìˆ˜ì§‘
        run: |
          TASKS="${{ github.event.inputs.tasks || 'standings results lineups' }}"
          TASKS=$(echo "$TASKS" | tr ',' ' ')
          echo "ğŸ“‹ ì‹¤í–‰: $TASKS"
          npx tsx scripts/collect.ts $TASKS
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          API_SPORTS_KEY: ${{ secrets.API_SPORTS_KEY }}
