# âš½ Soccer Brain - ì‹œê°„ë³„ ë°ì´í„° ìˆ˜ì§‘
# ë°°ë‹¹ íë¦„ ì¶”ì  + ìˆœìœ„/ê²°ê³¼/ë¼ì¸ì—… ë™ê¸°í™”
#
# GitHub Actionsê°€ í´ë¼ìš°ë“œì—ì„œ ì‹¤í–‰ â†’ PC êº¼ì ¸ë„ ë°ì´í„° ìˆ˜ì§‘ ê³„ì†

name: âš½ 10min Data Collection

on:
  schedule:
    # 10ë¶„ë§ˆë‹¤ ì‹¤í–‰ (UTC)
    - cron: "*/10 * * * *"
  
  # ìˆ˜ë™ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸/ë””ë²„ê·¸ìš©)
  workflow_dispatch:
    inputs:
      tasks:
        description: "ì‹¤í–‰í•  íƒœìŠ¤í¬ (ì‰¼í‘œ êµ¬ë¶„)"
        required: false
        default: "standings,results,odds,lineups"

jobs:
  collect:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm install --ignore-scripts
        env:
          PUPPETEER_SKIP_DOWNLOAD: "true"

      - name: ğŸ”§ Prisma ìƒì„±
        run: npx prisma generate

      - name: ğŸ¤– ë°ì´í„° ìˆ˜ì§‘
        run: |
          TASKS="${{ github.event.inputs.tasks || 'standings results odds lineups' }}"
          # ì‰¼í‘œë¥¼ ê³µë°±ìœ¼ë¡œ
          TASKS=$(echo "$TASKS" | tr ',' ' ')
          echo "ğŸ“‹ ì‹¤í–‰: $TASKS"
          npx tsx scripts/collect.ts $TASKS
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          API_SPORTS_KEY: ${{ secrets.API_SPORTS_KEY }}
